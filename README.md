
# üìä –ë–æ—Ç-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–¥–µ–æ

Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫, –∏—Å–ø–æ–ª—å–∑—É—è –ò–ò (Google Gemini) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite.

---

## üìñ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [‚ö° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)  
- [üí° –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤](#-–ø—Ä–∏–º–µ—Ä—ã-–∑–∞–ø—Ä–æ—Å–æ–≤)  
- [üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)  
  - [1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](#1-–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)  
  - [2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π](#2-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)  
  - [3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è](#3-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö-–æ–∫—Ä—É–∂–µ–Ω–∏—è)  
  - [4. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#4-—Å–æ–∑–¥–∞–Ω–∏–µ-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)  
  - [5. –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞](#5-—Å–æ–∑–¥–∞–Ω–∏–µ-telegram-–±–æ—Ç–∞)  
  - [6. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞ Google Gemini](#6-–ø–æ–ª—É—á–µ–Ω–∏–µ-api-–∫–ª—é—á–∞-google-gemini)  
- [‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫](#-–∑–∞–ø—É—Å–∫)  
- [üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)  
  - [`videos`](#videos)  
  - [`snapshots`](#snapshots)  
- [üìå –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞](#-–∫–æ–º–∞–Ω–¥—ã-–±–æ—Ç–∞)  
- [üìú –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)  
- [‚ö†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#Ô∏è-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)  
- [üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)  
- [üìù –õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)  
- [üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞](#-–ø–æ–¥–¥–µ—Ä–∂–∫–∞)  

---

## ‚ö° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–¥–µ–æ –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ  
- üîç –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é Google Gemini  
- üìà –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite  
- üí¨ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ Telegram  

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

–ë–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã —Ç–∏–ø–∞:

- "–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —É –≤—Å–µ—Ö –≤–∏–¥–µ–æ?"  
- "–ö–∞–∫–æ–µ —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤?"  
- "–°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ —Å–æ–∑–¥–∞–Ω–æ –≤ –∞–≤–≥—É—Å—Ç–µ 2025?"  
- "–ö–∞–∫–æ–π –æ–±—â–∏–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤?"  
- "–ö—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ?"  
- "–°–∫–æ–ª—å–∫–æ –ª–∞–π–∫–æ–≤ —É –≤–∏–¥–µ–æ [ID]?"  
- "–°—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —Å–æ–∑–¥–∞—Ç–µ–ª—è X –∑–∞ 28 –Ω–æ—è–±—Ä—è 2025 —Å 10:00 –¥–æ 15:00"  

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone https://github.com/h1nigami/bot-test-task.git
cd bot-test-task
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env` –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ:

```bash
cp .env.example .env
```

–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `.env`:

```env
# –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –æ—Ç @BotFather
BOT_TOKEN=your_telegram_bot_token_here

# API –∫–ª—é—á Google Gemini
GEMINI_API_KEY=your_gemini_api_key_here

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
HTTP_PROXY=http://127.0.0.1:12334
HTTPS_PROXY=http://127.0.0.1:12334
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –ø—É—Ç–∏ `database/videos.db`.  
–ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —è –∑–∞–∫–æ–º–º–∏—Ç–∏–ª —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ç–∞–∫ –∫–∞–∫ –≤ –∑–∞–¥–∞–Ω–∏–∏ –±—ã–ª –ø—É–Ω–∫—Ç –ø—Ä–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –±–¥

(—Å–¥–µ–ª–∞–ª sqlite –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª postgresql –ø—Ä–æ—Å—Ç–æ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞, —ç—Ç–æ –≤—Å—ë –ª–µ–≥–∫–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ postgresql)

### 5. –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞
1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram  
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`  
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω  
4. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ñ–∞–π–ª `.env`

### 6. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞ Google Gemini
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google AI Studio](https://studio.google.com)  
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á  
3. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤ —Ñ–∞–π–ª `.env`

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
```bash
python main.py
```

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å-–º–µ–Ω–µ–¥–∂–µ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä PM2:

```bash
pm2 start main.py --name video-bot
```

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### `videos`
–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤–∏–¥–µ–æ:

| –ü–æ–ª–µ              | –¢–∏–ø       | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------------|----------|----------|
| video_id          | TEXT PK  | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ |
| views_count       | INTEGER  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ |
| likes_count       | INTEGER  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ |
| comments_count    | INTEGER  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ |
| reports_count     | INTEGER  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∞–ª–æ–± |
| creator_id        | TEXT     | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–∑–¥–∞—Ç–µ–ª—è |
| video_created_at  | DATETIME | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ |
| created_at        | DATETIME | –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ë–î |
| updated_at        | DATETIME | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

### `snapshots`
–¢–∞–±–ª–∏—Ü–∞ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

| –ü–æ–ª–µ                 | –¢–∏–ø       | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------------|----------|----------|
| id                   | INTEGER PK | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–Ω–∞–ø—à–æ—Ç–∞ |
| video_id             | TEXT FK  | –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ |
| delta_views_count    | INTEGER  | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ |
| delta_likes_count    | INTEGER  | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∞–π–∫–æ–≤ |
| delta_comments_count | INTEGER | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ |
| delta_reports_count  | INTEGER | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∂–∞–ª–æ–± |
| created_at           | DATETIME | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–Ω–∞–ø—à–æ—Ç–∞ |

---

## üìå –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` ‚Äî –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º  
- `/help` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É  
- `/stats` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö  

---

## üìú –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –≤–µ–¥—ë—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.  
–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —Ñ–∞–π–ª.

---

## ‚ö†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

- **Invalid token**: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω  
- **API key not valid**: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ GEMINI_API_KEY  
- **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î**: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `database/videos.db` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω  
- **–ü—Ä–æ–∫—Å–∏-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env` –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞  

---

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥: —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –º–µ—Ç–æ–¥ `_register_handlers` –≤ `handlers/main_handler.py`  
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ LLM: —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –º–µ—Ç–æ–¥ `_create_system_prompt` –≤ `LLM/LLM_manager.py`  
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü: –æ–±–Ω–æ–≤–∏—Ç–µ `_get_table_description`, `_get_column_description` –∏ –ø—Ä–∏–º–µ—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç–µ LLM

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

---
